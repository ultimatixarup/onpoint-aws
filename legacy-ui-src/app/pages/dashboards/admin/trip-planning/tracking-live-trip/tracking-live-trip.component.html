<!-- Live Tracking Component -->
<div class="page-content page-content-main">
    <div class="row" style="margin-left: 0px; margin-right: 0px;">
      <!-- Left Sidebar -->
      <div class="col-xs-12 col-lg-2 navbar-side-menu">
        <app-sidebar></app-sidebar>
      </div>
      <!-- Left Sidebar End -->

      <!-- Right Side Content -->
     <div class="col-xs-12 col-lg-10 content-right">
        <!-- Breadcrumb and Filter -->
        <div class="page-content-main">
          <div class="row">
            <div class="col-xs-12 col-lg-12">
              <span class="breadcrumb-left">
                <h1 class="login-headline heading-title">
                    Tracking <span class="heading-title-small">Live Trip</span>
                </h1>
                <!-- <ng-container *ngIf="user ==='role_user_fleet'">
                  <div class="content-text">
                    <span class="vin_container">
                      <span class="content-sub-text">Fleet Id</span>
                    </span>
                    <span class="content-sub-text2">{{ selectedFleetDisplay || fleetIdValueNew }}</span>
                  </div>
                </ng-container> -->
              </span>
              <span class="breadcrumb-right mr-8">
                <ol class="breadcrumb">
                  <li class="breadcrumb-item">
                    <a routerLink="/adlp/admin" class="breadcrumb-h6"><i class="bx bx-home-circle"></i></a>
                  </li>
                  <li class="breadcrumb-item inactive-bread">
                    <a routerLink="/adlp/admin/admindashboard/dashboardfleet">Dashboard</a>
                  </li>
                  <li class="breadcrumb-item text-selected active-bread">Tracking Live Trip</li>
                </ol>
              </span>
            </div>
          </div>

          <!-- Fleet Id Filter (like Trip Planning; no group) -->
          <div class="row consumer-pad justify-content-end my-2" *ngIf="user !='role_user_fleet'">
            <div class="col-xs-12 col-lg-2 mr-3">
              <ng-select
                [searchable]="true"
                class="newSelect1"
                [clearable]="true"
                placeholder="Organization Id/Name"
                (clear)="clearFleetSelection()"
                (change)="selectFleetId()"
                [(ngModel)]="fleetIdData">
                <ng-option *ngFor="let fleet of fleetList" [value]="fleet.id">
                  {{fleet.id}} - [{{fleet.name}}]
                </ng-option>
              </ng-select>
            </div>
          </div>
          <!-- Fleet Id Filter end -->


          <!-- <div class="row mt-3"> -->



            <!-- Date Picker Toggle Button -->
            <!-- <div class="col-12 col-lg-6" (click)="$event.stopPropagation()">
              <input
                class="form-control input-vins"
                maxlength="17"
                type="text"
                (click)="toggleDatePicker()"
                [value]="dateRangeLabel()"
                placeholder="Pick Trip Date"
                readonly
              /> -->

              <!-- Datepicker will only be visible if `isDatePickerVisible` is true -->
              <!-- <div *ngIf="isDatePickerVisible" class="datepicker-container mt-2" (click)="$event.stopPropagation()">
                <ngb-datepicker
                  #dp
                  (dateSelect)="onDateSelection($event)"
                  [displayMonths]="2"
                  [dayTemplate]="t"
                  outsideDays="hidden"
                ></ngb-datepicker> -->

                <!-- Custom Day Template -->
                <!-- <ng-template #t let-date let-focused="focused">
                  <span
                    class="custom-day"
                    [class.focused]="focused"
                    [class.range]="isRange(date)"
                    [class.faded]="isHovered(date) || isInside(date)"
                    (mouseenter)="hoveredDate = date"
                    (mouseleave)="hoveredDate = null"
                  >
                    {{ date.day }}
                  </span>
                </ng-template>
              </div>
            </div>
            <div class="col-12 col-lg-6">
              <input
                class="form-control input-vins"
                maxlength="17"
                [(ngModel)]="tripName"
                type="text"
                (keyup.enter)="findTripDetails()"
                placeholder="Search by Trip Name"
              />
            </div>
          </div> -->



          <!-- Table for Trip Details -->
          <div class="row mr-table" style="margin-top: 24px">
            <div class="col-lg-12 col-xs-12">
              <div class="table-responsive table-b">
                <table class="table">
                  <thead class="table-head">
                    <tr>
                      <th style="width: 15%;">Name</th>
                      <th style="width: 15%;">Start Location</th>
                      <th style="width: 12%;">Start Date</th>
                      <th style="width: 8%;">Start Time</th>
                      <th style="width: 10%;">Status</th>
                      <th style="width: 7%;">Stops</th>
                      <th style="width: 15%;">Driver Name</th>
                      <th style="width: 15%;">Vehicle Name</th>
                      <th style="width: 20%;">Trip Tracker</th>
                    </tr>
                  </thead>
                  <tbody>
                    <ng-container *ngIf="loading">
                      <tr>
                        <td colspan="9">
                          <h5 class="heading-c">Loading...</h5>
                        </td>
                      </tr>
                    </ng-container>
                    <ng-container *ngIf="!loading && trips.length > 0">
                      <tr *ngFor="let trip of trips">
                        <td>{{ trip.tripName }}</td>
                        <td>
                          {{ trip.deliveryLocations[0]?.streetAddress || 'N/A' }},
                          {{ trip.deliveryLocations[0]?.city || 'N/A' }},
                          {{ trip.deliveryLocations[0]?.state || 'N/A' }}
                        </td>
                        <td>{{ trip.tripStartDateTime | date: 'yyyy-MM-dd' }}</td>
                        <td>{{ trip.tripStartDateTime | date: 'hh:mm a' }}</td>
                        <td>{{ formatStatus(trip.status) }}</td>
                        <td>{{ trip.deliveryLocations.length }}</td>
                        <td>
                          <ng-container *ngIf="trip.driverId; else noDriver">
                            {{ getDriverName(trip.driverId, trip.id) }}
                          </ng-container>
                          <ng-template #noDriver>
                            <a [routerLink]="['/adlp/admin/admindashboard/trip-planning/assign-trip-driver', trip.id]">
                              No Driver Assigned
                            </a>
                          </ng-template>
                        </td>
                        <td>{{ getVehicleName(trip.driverId) }}</td>
                        <td>
                            <button class="btn btn-info btn-sm" [routerLink]="['/adlp/admin/admindashboard/trip-planning/tracking-live-trip/', trip.id]">
                                <i class="fa-solid fa-map"></i>
                              </button>

                          </td>
                      </tr>
                    </ng-container>
                    <ng-container *ngIf="!loading && trips.length === 0">
                      <tr>
                        <td colspan="9">
                          <h5 class="heading-c">No Data Found ...</h5>
                        </td>
                      </tr>
                    </ng-container>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <!-- Table for Trip Details End -->

          <!-- Pagination -->
          <div class="mt-2 text-end pagination-h">
            <!-- Number Pagination-->
            <span *ngIf="pages?.length <=9" class="f-le">
              <div>
                <nav class="isolate inline-flex -space-x-px rounded-md shadow-sm pag-color" aria-label="Pagination">
                  <a (click)="selectPages(pageNumber - 1)" href="javascript:(Void)" [class.disabled]="pageNumber == 1"
                    class="page pointer relative inline-flex items-center rounded-l-md px-2 py-2 text-sm font-medium text-gray-500 hover:bg-gray-50 focus:z-20">
                    <span class="sr-only">Previous</span>
                    <img src="../../../../../assets/images/left-img.svg">
                  </a>


                  <ng-container *ngFor="let page of pages">
                    <a [class.isActive]="page == pageNumber" href="javascript:(void)" [ngClass]="{'pointer' : page != '...'}"
                      aria-current="page" (click)="selectPages(page)" class=" px-4 py-2 pageination-number">{{page}}
                    </a>
                  </ng-container>


                  <a (click)="selectPages(pageNumber + 1)" [class.disabled]="pageNumber == totalPages"
                    class=" page pointer relative inline-flex items-center rounded-r-md px-2 py-2 text-sm font-medium text-gray-500 hover:bg-gray-50 focus:z-20">
                    <span class="sr-only">Next</span>
                    <img src="../../../../../assets/images/right.svg">
                  </a>
                </nav>
              </div>
            </span>
            <span *ngIf="pages?.length >9" class="f-ri">
              <div>
                <nav class="isolate inline-flex -space-x-px rounded-md shadow-sm" aria-label="Pagination">
                  <a (click)="selectPages(pageNumber - 1)" [class.disabled]="pageNumber == 1"
                    class="page pointer relative inline-flex items-center rounded-l-md px-2 py-2 text-sm font-medium text-gray-500 hover:bg-gray-50 focus:z-20">
                    <span class="sr-only">Previous</span>
                    <img src="../../../../../assets/images/left-img.svg">
                  </a>

                  <ng-container *ngFor="let page of pages">
                    <a [class.isActive]="page == pageNumber" *ngIf="( (page < pages.length && page  > 1))" aria-current="page"
                      (click)="selectPages(page)"
                      [ngStyle]="{'display': ((page > pageNumber+1 ||  page < pageNumber-1) && page < (pages.length)) ? 'none':''}"
                      class=" px-4 py-2 pageination-number">{{page}}
                    </a>
                  </ng-container>

                  <ng-container *ngIf="pageNumber < (pages.length-2)">
                    <a aria-current="page" (click)="selectPages(pageNumber+1)"
                      class="page relative z-10 inline-flex items-center  px-4 py-2 text-sm font-medium text-indigo-600 focus:z-20 active:bg-blue-700 focus:bg-blue-500 hover:bg-blue-700 hover:text-white ">{{"."}}
                    </a>
                  </ng-container>

                  <ng-container>
                    <a aria-current="page" [class.isActive]="(pageNumber == pages.length )" (click)="selectPages(pages.length)"
                      class=" px-4 py-2 pageination-number">{{pages.length}}
                    </a>
                  </ng-container>

                  <ng-container *ngFor="let page of pages">
                    <a [class.isActive]="page == pageNumber" class="page-display" aria-current="page"
                      (click)="selectPages(page)" class=" px-4 py-2 pageination-number">{{page}}
                    </a>
                  </ng-container>


                  <a (click)="selectPages(pageNumber + 1)" [class.disabled]="pageNumber == totalPages"
                    class=" page relative inline-flex items-center rounded-r-md border border-gray-300 bg-white px-2 py-2 text-sm font-medium text-gray-500 hover:bg-gray-50 focus:z-20">
                    <span class="sr-only">Next</span>
                    <img src="../../../../../assets/images/right.svg">
                  </a>
                </nav>
              </div>
            </span>
            <!-- Number Pagination End-->
             <!-- Page Size Pagination-->
            <span class="f-ri">
              <select class="form-select" (change)="selectPage($event.target.value)" [(ngModel)]="pageSize">
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="20">20</option>
                <option value="40">40</option>
                <option value="80">80</option>
                <option value="100">100</option>
              </select>
            </span>
            <span class="pageination">Per Page</span>
             <!-- Page Size Pagination End-->
          </div>
          <!-- Pagination End -->
        </div>
      </div>
      <!-- Right Side Content End -->
    </div>
  </div>
  <!-- Live Tracking Component End -->
  <!-- Modal for displaying map -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="btn-close rounded-circle p-2 border border-1 fs-6" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <iframe
          src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3557.417505776218!2d78.0271616!3d27.2171008!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zMjfCsDEyJzE2LjEiTiA3OMKwMDEnMzcuNiJF!5e0!3m2!1sen!2sin!4v1693144577071!5m2!1sen!2sin"
          width="100%"
          height="400"
          style="border:0;"
          allowfullscreen=""
          loading="lazy"
          referrerpolicy="no-referrer-when-downgrade">
        </iframe>
      </div>
    </div>
  </div>
</div>
