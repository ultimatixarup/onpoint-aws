<div class="page-content page-contents page-content-main">
  <div class="row sideMenuItem">
    <div class="container">
        <div class="col-xs-12 content-right">
          <div class="row">
            <div class="col-xs-12 col-lg-12">
              <span class="breadcrumb-left">
                <h1 class="login-headline heading-title">AI ChatBot</h1>
              </span>
            </div>
          </div>
          <div class="row">
            <div class="chatgpt-page">
              <div class="row" *ngIf="messages.length === 0">
                <div class="row justify-content-center align-items-center full-height">
                  <div class="col-xs-12 col-lg-6 d-flex justify-content-center align-items-center">
                    <img src="../../../../../../assets/images/chatbot-icon.svg" class="chatbot-img me-3">
                    <h5 class="name-head">Hi, {{ nameOfUser }}</h5>
                  </div>
                </div>
                <div class="row" style="margin-top: 12px; margin-left:12px; margin-bottom: 12px;">
                  <div class="col-xs-12 col-lg-12 text-center">
                    <h5 class="help">How can I help you today? </h5>
                  </div>
                </div>
                <div class="row justify-content-center" style="margin-top: 24px;">
                  <div class="col-auto">
                    <div class="custom-btn" (click)="sendQuickMessage('How to run VIN eligibility?')">How to run VIN eligibility?</div>
                  </div>
                  <div class="col-auto">
                    <div class="custom-btn" (click)="sendQuickMessage('How vehicle consent works?')">How vehicle consent works?</div>
                  </div>
                  <div class="col-auto">
                    <div class="custom-btn" (click)="sendQuickMessage('What is the process for vehicle enrollment?')">What is the process for vehicle enrollment?</div>
                  </div>
                </div>
              </div>
              <div class="chatgpt-page" [class.has-messages]="messages.length > 0" style="margin-top: -12px; background-color: transparent!important; position: sticky;">
                <div class="chatgpt-messages" #messagesContainer #scrollMe [scrollTop]="scrollMe.scrollHeight">
                  <div *ngFor="let msg of messages"
                       class="chatgpt-message"
                       [ngClass]="{'user-message': msg.isUser, 'bot-message': !msg.isUser}">

                   <!-- Bot Message -->
            <ng-container *ngIf="!msg.isUser">
              <div class="bot-message-container">
                <img src="../../../../../../assets/images/chatbot-icon.svg" class="bot-image" />

                <!-- Show either the bot text or typing dots -->
                <div class="bot-text">
                  <ng-container *ngIf="msg.text; else typing">
                    <div class="bot-message" #messageContent [innerHTML]="formatMessage(msg.text)"></div>
                    <div class="copy-icon-container">
                      <div class="col-xs-12 col-lg-12">
                        <button class="copy-icon"   *ngIf="copiedMessageId !== msg.id"  (click)="copyMessage(msg.text, msg.id)">
                          <i class="fa fa-copy" style="font-size: 12px;"></i>
                         </button>
                      </div>
                      <div class="col-xs-12 col-lg-12" style="margin-top: -24px;">
                        <span *ngIf="copiedMessageId === msg.id" class="copied-label">
                          <i class="fa fa-check"></i> Copied
                        </span>
                      </div>

                    </div>
                  </ng-container>

                  <ng-template #typing>
                    <div class="typing-dots">
                      <span class="dot"></span>
                      <span class="dot"></span>
                      <span class="dot"></span>
                    </div>
                  </ng-template>
                </div>



                <!-- Optional PDF download -->
                <button *ngIf="msg?.pdfFile" (click)="downloadPdf(msg.pdfFile)" class="pdf-download-btn">
                  <i class='bx bx-download'></i>
                </button>
              </div>
            </ng-container>

            <!-- User Message -->
            <ng-container *ngIf="msg.isUser">
              <div class="user-text">{{ msg.text }}</div>
            </ng-container>
                  </div>
                  <!-- Typing indicator -->
            <div class="chatgpt-message bot-message typing-indicator" *ngIf="isTyping">
              <img src="../../../../../../assets/images/chatbot-icon.svg" class="bot-image" />
              <div class="bot-text typing-dots">
                <span>.</span><span>.</span><span>.</span>
              </div>
            </div>

                </div>
                <!-- Input box -->

              <div class="chatgpt-input-wrapper">
                  <div class="chat-container px-4 py-2">
                    <textarea
                    id="chat-input"
                    rows="5"
                    class="form-control border-0 shadow-none chat-input"
                    placeholder="Ask anything"
                    (keydown.enter)="handleSend($event)"
                    [(ngModel)]="userMessage"
                    [ngModelOptions]="{ standalone: true }"
                  ></textarea>

                  <!-- <label class="upload-btn">
                    <input type="file" (change)="uploadCSV($event)" (click)="$event.target.value = null"  accept=".csv" hidden />
                    <i class="fa fa-paperclip icon-btn" style="cursor: pointer;" title="Upload CSV only" ></i>
                  </label>
                  <button (click)="toggleRecording()" class="mic-btn" >
                    <i class="fa fa-microphone attachBtn" [ngClass]="{ 'recording': isRecording }"></i>
                  </button> -->
                  <div class="d-flex justify-content-end align-items-center mt-2">
                    <div class="tooltip-wrapper">
                      <div class="upload-wrapper">
                        <label class="upload-btn icon-btn" style="margin-right: 6px;">
                          <input type="file"
                                 (change)="uploadCSV($event)"
                                 (click)="$event.target.value = null"
                                 accept=".csv"
                                 hidden />
                          <i class="fa fa-paperclip icon-btn" style="cursor: pointer; height: 17px;" title="Upload CSV only"></i>
                        </label>
                      </div>

                      <div class="custom-tooltip">
                        <p style="font-size: 12px; font-weight: 600; text-align: left; font-family: 'Poppins';">VIN eligibility file only.</p>
                        <div class="tooltip-actions">
                          <span style="float: left;"> Upload .csv only</span>
                          <span style="float: right;"> <a href="javascript:(void)" (click)="downloadSamples()" download>Download sample csv</a></span>

                        </div>
                      </div>
                    </div>
                    <button type="button" (click)="toggleRecording()" class="icon-btn me-2">
                      <i class="fa fa-microphone" [ngClass]="{ 'recording': isRecording }"></i>
                    </button>
                    <button type="button"  class="icon-btn"  (click)="sendMessage()">
                      <i class="fa fa-paper-plane"></i>
                    </button>
                  </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>
    </div>
  </div>
</div>
