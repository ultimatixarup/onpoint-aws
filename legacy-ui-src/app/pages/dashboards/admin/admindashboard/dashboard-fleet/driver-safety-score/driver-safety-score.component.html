<ngx-spinner bdColor="rgba(0,0,0,0.8)" size="large" color="#fff" type="ball-elastic-dots" [fullScreen]="true">
  <div class="custom-spinner">
    <img src="../../../../../assets/images/spinner3.svg" alt="Loading">
  </div>
  <div class="loading-text">Please wait, we are getting information...</div>
</ngx-spinner>

<!-- Main content -->
<div class="page-content page-content-main">
  <div class="row left-navigation">
    <!-- Left side menu -->
    <div class="col-xs-12 col-lg-2 navbar-side-menu">
      <app-sidebar></app-sidebar>
    </div>
    <!-- Left side menu end -->

    <!-- Right side content -->
    <div class="col-xs-12 col-lg-10 content-right" style="margin-left: 2%; width: 100%;">
      <!-- Breadcrumb -->
      <div class="row">
        <div class="col-xs-12 col-lg-12">
          <span class="breadcrumb-left">
            <h1 class="login-headline heading-title">Customize Safety Score</h1>
          </span>
          <span class="breadcrumb-right mr-8">
            <ol class="breadcrumb">
              <li class="breadcrumb-item">
                <a routerLink="/adlp/admin/admindashboard/dashboardfleet" class="breadcrumb-h6">
                  <i class="bx bx-home-circle"></i>
                </a>
              </li>
              <li class="breadcrumb-item inactive-bread">
                <a routerLink="/adlp/admin/admindashboard/dashboardfleet">Dashboard</a>
              </li>
              <li class="breadcrumb-item text-selected active-bread">Customize Safety Score</li>
            </ol>
          </span>
        </div>
      </div>
      <!-- Breadcrumb end -->

      <!-- Fleet Filter -->
      <div class="row consumer-pad justify-content-end my-2">
        <div class="col-xs-12 col-lg-3 mr-3" *ngIf="user !='role_user_fleet' && user !='role_Driver' && user != 'role_org_group'">
          <ng-select
            [items]="fleetList"
            bindLabel="name"
            bindValue="id"
            [searchable]="true"
            class="newSelect1"
            [clearable]="true"
            placeholder="Select Organization Id/Name"
            [(ngModel)]="fleetIdData"
            (change)="onFleetChange($event)">
            <ng-template ng-label-tmp let-item="item">
              {{ item.id }} - [{{ item.name }}]
            </ng-template>
            <ng-template ng-option-tmp let-item="item">
              {{ item.id }} - [{{ item.name }}]
            </ng-template>
          </ng-select>
        </div>
        <div class="col-xs-12 col-lg-3 mr-3" *ngIf="user =='role_user_fleet' || user =='role_Driver' || user == 'role_org_group'">
          <span class="content-sub-text2">Fleet ID: {{ fleetIdValueNew || fleetIdData }}</span>
        </div>
      </div>
      <!-- Fleet Filter end -->

      <!-- Current Safety Score Display -->
      <div class="row consumer-pad" *ngIf="searchFleets && safetyScoreWeights">
        <div class="card-container">
          <div class="card-item">
            <div class="safety-header">
              <h3 class="safety-title" style="font-size: 18px; margin-bottom: 10px;">
                <i class='bx bx-shield-alt-2' style="margin-right: 8px;"></i>
                Current Safety Score Configuration
              </h3>
              <p class="safety-description" style="margin-bottom: 15px;">
                Current weightage distribution for Fleet ID: <strong>{{ searchFleets }}</strong>
              </p>
            </div>

            <div class="row" style="padding: 10px 20px;">
              <div class="col-md-3 col-sm-6 mb-3">
                <div class="weight-display-box">
                  <div class="weight-label">OverSpeeding</div>
                  <div class="weight-value">{{ safetyScoreWeights.overSpeeding }}%</div>
                </div>
              </div>
              <div class="col-md-3 col-sm-6 mb-3">
                <div class="weight-display-box">
                  <div class="weight-label">Excessive OverSpeeding</div>
                  <div class="weight-value">{{ safetyScoreWeights.excessiveOverSpeeding }}%</div>
                </div>
              </div>
              <div class="col-md-3 col-sm-6 mb-3">
                <div class="weight-display-box">
                  <div class="weight-label">Harsh Acceleration</div>
                  <div class="weight-value">{{ safetyScoreWeights.harshAcceleration }}%</div>
                </div>
              </div>
              <div class="col-md-3 col-sm-6 mb-3">
                <div class="weight-display-box">
                  <div class="weight-label">Harsh Braking</div>
                  <div class="weight-value">{{ safetyScoreWeights.harshBraking }}%</div>
                </div>
              </div>
              <div class="col-md-3 col-sm-6 mb-3">
                <div class="weight-display-box">
                  <div class="weight-label">Harsh Cornering</div>
                  <div class="weight-value">{{ safetyScoreWeights.harshCornering }}%</div>
                </div>
              </div>
              <div class="col-md-3 col-sm-6 mb-3">
                <div class="weight-display-box">
                  <div class="weight-label">Night Driving</div>
                  <div class="weight-value">{{ safetyScoreWeights.nightDriving }}%</div>
                </div>
              </div>
              <div class="col-md-3 col-sm-6 mb-3">
                <div class="weight-display-box">
                  <div class="weight-label">Seatbelt Compliance</div>
                  <div class="weight-value">{{ safetyScoreWeights.seatbeltCompliance }}%</div>
                </div>
              </div>
              <div class="col-md-3 col-sm-6 mb-3">
                <div class="weight-display-box total-box">
                  <div class="weight-label">Total</div>
                  <div class="weight-value total-value">{{ calculateSavedTotal() }}%</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Current Safety Score Display end -->

      <!-- Safety Score Configuration Card -->
      <div class="row consumer-pad">
        <div class="card-container">
          <div class="card-item safety-score-card">

            <!-- Header Section -->
            <div class="safety-header">
              <h2 class="safety-title">Customize Safety Score</h2>
              <p class="safety-description">
                Set the weightages of various driving behaviors to align driver safety scores with your fleet's safety policies and
                performance standards. The default % shown below are as per industry standards.
              </p>
            </div>

            <!-- Safety Score Items -->
            <div class="safety-items-container">

              <!-- OverSpeeding -->
              <div class="safety-item">
                <div class="safety-item-content">
                  <div class="safety-icon">
                    <i class='bx bx-tachometer'></i>
                  </div>
                  <div class="safety-item-text">
                    <h3 class="safety-item-title">OverSpeeding</h3>
                    <p class="safety-item-description">Driving above the designated safe speed limit for a particular road.</p>
                  </div>
                </div>
                <div class="safety-input-container">
                  <input
                    type="number"
                    class="safety-input"
                    [(ngModel)]="tempWeights.overSpeeding"
                    min="0"
                    max="100">
                  <span class="percentage-sign">%</span>
                </div>
              </div>

              <!-- Excessive OverSpeeding -->
              <div class="safety-item">
                <div class="safety-item-content">
                  <div class="safety-icon">
                    <i class='bx bx-tachometer'></i>
                  </div>
                  <div class="safety-item-text">
                    <h3 class="safety-item-title">Excessive OverSpeeding</h3>
                    <p class="safety-item-description">Driving at speeds 15% above OverSpeeding limit significantly increases accident risk.</p>
                  </div>
                </div>
                <div class="safety-input-container">
                  <input
                    type="number"
                    class="safety-input"
                    [(ngModel)]="tempWeights.excessiveOverSpeeding"
                    min="0"
                    max="100">
                  <span class="percentage-sign">%</span>
                </div>
              </div>

              <!-- Harsh Acceleration -->
              <div class="safety-item">
                <div class="safety-item-content">
                  <div class="safety-icon">
                    <i class='bx bx-trending-up'></i>
                  </div>
                  <div class="safety-item-text">
                    <h3 class="safety-item-title">Harsh Acceleration</h3>
                    <p class="safety-item-description">A sudden, aggressive increase in speed signals risky or inefficient driving.</p>
                  </div>
                </div>
                <div class="safety-input-container">
                  <input
                    type="number"
                    class="safety-input"
                    [(ngModel)]="tempWeights.harshAcceleration"
                    min="0"
                    max="100">
                  <span class="percentage-sign">%</span>
                </div>
              </div>

              <!-- Harsh Braking -->
              <div class="safety-item">
                <div class="safety-item-content">
                  <div class="safety-icon">
                    <i class='bx bx-stop-circle'></i>
                  </div>
                  <div class="safety-item-text">
                    <h3 class="safety-item-title">Harsh Braking</h3>
                    <p class="safety-item-description">A sudden, forceful stop indicates aggressive or unsafe driving.</p>
                  </div>
                </div>
                <div class="safety-input-container">
                  <input
                    type="number"
                    class="safety-input"
                    [(ngModel)]="tempWeights.harshBraking"
                    min="0"
                    max="100">
                  <span class="percentage-sign">%</span>
                </div>
              </div>

              <!-- Harsh Cornering -->
              <div class="safety-item">
                <div class="safety-item-content">
                  <div class="safety-icon">
                    <i class='bx bx-shape-triangle'></i>
                  </div>
                  <div class="safety-item-text">
                    <h3 class="safety-item-title">Harsh Cornering</h3>
                    <p class="safety-item-description">Extreme sharp turns at high speed indicates risky or unstable driving.</p>
                  </div>
                </div>
                <div class="safety-input-container">
                  <input
                    type="number"
                    class="safety-input"
                    [(ngModel)]="tempWeights.harshCornering"
                    min="0"
                    max="100">
                  <span class="percentage-sign">%</span>
                </div>
              </div>

              <!-- Night Driving -->
              <div class="safety-item">
                <div class="safety-item-content">
                  <div class="safety-icon">
                    <i class='bx bx-moon'></i>
                  </div>
                  <div class="safety-item-text">
                    <h3 class="safety-item-title">Night Driving</h3>
                    <p class="safety-item-description">Indicates increased risk due to reduced visibility and driver fatigue.</p>
                  </div>
                </div>
                <div class="safety-input-container">
                  <input
                    type="number"
                    class="safety-input"
                    [(ngModel)]="tempWeights.nightDriving"
                    min="0"
                    max="100">
                  <span class="percentage-sign">%</span>
                </div>
              </div>

              <!-- Seatbelt Compliance -->
              <div class="safety-item">
                <div class="safety-item-content">
                  <div class="safety-icon">
                    <i class='bx bx-user-check'></i>
                  </div>
                  <div class="safety-item-text">
                    <h3 class="safety-item-title">Seatbelt Compliance</h3>
                    <p class="safety-item-description">Analyzes the distance traveled without a seatbelt as a key indicator.</p>
                  </div>
                </div>
                <div class="safety-input-container">
                  <input
                    type="number"
                    class="safety-input"
                    [(ngModel)]="tempWeights.seatbeltCompliance"
                    min="0"
                    max="100">
                  <span class="percentage-sign">%</span>
                </div>
              </div>

            </div>

            <!-- Total Percentage Display -->
            <div class="total-percentage" [ngClass]="{'invalid-total': calculateTotal() !== 100}">
              <span class="total-label">Total:</span>
              <span class="total-value">{{ calculateTotal() }}%</span>
              <span class="total-warning" *ngIf="calculateTotal() !== 100">
                (Total must equal 100%)
              </span>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
              <button class="btn-reset" (click)="resetToDefaults()">
                Reset to Default
              </button>
              <button class="btn-save" (click)="saveSafetyScoreWeights()">
                Save
              </button>
            </div>

          </div>
        </div>
      </div>

    </div>
  </div>
</div>
