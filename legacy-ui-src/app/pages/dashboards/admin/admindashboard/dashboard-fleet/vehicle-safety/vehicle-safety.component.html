<ngx-spinner
  bdColor="rgba(0,0,0,0.8)"
  size="large"
  color="#fff"
  type="ball-elastic-dots"
  [fullScreen]="true"
>
  <div class="custom-spinner">
    <img src="../../../../../assets/images/spinner3.svg" alt="Your Logo" />
  </div>
  <div class="loading-text">Please wait, we are getting information...</div>
</ngx-spinner>

<div class="page-content page-content-main">
  <div class="row left-navigation">
    <!-- Left side menu-->
    <div class="col-xs-12 col-lg-2 navbar-side-menu">
      <app-sidebar></app-sidebar>
    </div>

    <!-- Right side content -->
    <div
      class="col-xs-12 col-lg-10 content-right"
      style="margin-left: 18%; width: 82%"
    >
      <!-- Header and Breadcrumb -->
      <div class="row">
        <div class="col-xs-12 col-lg-12">
          <span class="breadcrumb-left">
            <h1 class="login-headline heading-title">Driver Safety Summary</h1>
          </span>
          <span class="breadcrumb-right mr-8">
            <ol class="breadcrumb">
              <li class="breadcrumb-item">
                <a
                  routerLink="/adlp/admin/admindashboard/dashboardfleet"
                  class="breadcrumb-h6"
                >
                  <i class="bx bx-home-circle"></i>
                </a>
              </li>
              <li class="breadcrumb-item inactive-bread">
                <a routerLink="/adlp/admin/admindashboard/dashboardfleet"
                  >Dashboard</a
                >
              </li>
              <li class="breadcrumb-item text-selected active-bread">
                Driver Safety Summary
              </li>
            </ol>
          </span>
        </div>
      </div>

      <!-- Summary Cards -->
      <div class="row mr-24">
        <div class="col-xs-12 col-lg-12">
          <div class="card">
            <div class="card-body">
              <div class="row">
                <!-- Driver Behavior -->
                <div class="col-xs-12 col-md">
                  <div class="box5 orange-border">
                    <div class="content-section-heading">
                      <span
                        class="text_number loding-back"
                        [ngClass]="{ 'loading-background': isloading2 }"
                      >
                        {{ isDataNotFound ? "No Data" : totalVehicleCount }}
                      </span>
                    </div>
                    <div class="content-section-text">Total Vehicle Count</div>
                  </div>
                </div>

                <div class="col-xs-12 col-md">
                  <div class="box5 red-border">
                    <div class="content-section-heading">
                      <span
                        class="text_number loding-back"
                        [ngClass]="{ 'loading-background': isloading2 }"
                      >
                        {{ isDataNotFound ? "No Data" : totalDistanceTravelled }}
                      </span>
                    </div>
                    <div class="content-section-text">Total Distance Travelled</div>
                  </div>
                </div>
                <!-- Total Incidents -->
                <div class="col-xs-12 col-md">
                  <div class="box5 green-border">
                    <div class="content-section-heading">
                      <span
                        class="text_number loding-back"
                        [ngClass]="{ 'loading-background': isloading2 }"
                      >
                        {{
                          isDataNotFound
                            ? "No Data"
                            : (avgCostPerMile | number : "1.2-2")
                        }}
                      </span>
                    </div>
                    <div class="content-section-text">Average Cost Per Mile</div>
                  </div>
                </div>

                <!-- Average Safety Score -->
                <div class="col-xs-12 col-md">
                  <div class="box5 purple-border">
                    <div class="content-section-heading">
                      <span
                        class="text_number loding-back"
                        [ngClass]="{ 'loading-background': isloading2 }"
                      >
                        {{
                          isDataNotFound
                            ? "No Data"
                            : (avgIdlingDuration | number : "1.2-2")
                        }}%
                      </span>
                    </div>
                    <div class="content-section-text">Average Idling Duration</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- VIN, OEM and status filter -->
      <div class="row">
        <div class="col-xs-12 col-lg-6">&nbsp;</div>
        <div class="col-12 col-lg-2">
          <input
            class="form-control input-vins font-common"
            maxlength="17"
            type="text"
            (keyup.enter)="selectConsumer()"
            [(ngModel)]="searchText"
            placeholder="Enter VIN"
          />
        </div>
        <div class="col-12 col-lg-2">
          <ng-select
            [items]="allOem"
            bindLabel="oem"
            placeholder="Select OEM"
            [(ngModel)]="searchByOem"
            class="font-common"
            (change)="selectConsumerData($event)"
          >
          </ng-select>
        </div>
        <div class="col-12 col-lg-2">
          <ng-select
            [items]="[
              { id: '', name: 'All' },
              { id: 'ACTIVE', name: 'Active' },
              { id: 'PENDING', name: 'Pending' },
              { id: 'FAILED', name: 'Failed' },
              { id: 'PAUSED', name: 'Paused' },
              { id: 'DEACTIVATED', name: 'Deactivated' },
              { id: 'DEACTIVATION_PENDING', name: 'Deactivation Pending' },
              { id: 'DEACTIVATION_FAILED', name: 'Deactivation Failed' }
            ]"
            bindLabel="name"
            bindValue="id"
            placeholder="All VIN Status"
            [(ngModel)]="searchByStatus"
            class="font-common"
          >
          </ng-select>
        </div>
      </div>

      <!-- Main data table-->
      <div class="row mr-table mr-6">
        <div class="col-lg-12 col-xs-12">
          <div class="table-wrapper">
            <div class="table-responsive table-b">
              <table class="table">
                <thead class="table-head">
                  <tr>
                    <th class="table-column-width5">Vehicle Name</th>
                    <th class="text-center table-column-width">Model Year</th>
                    <th class="text-center table-column-width">
                      Class
                    </th>
                    <th class="text-center table-column-width">
                      Fuel Type
                    </th>
                    <th class="text-center table-column-width">
                      DTC Alert
                    </th>
                    <th class="text-center table-column-width">
                      Average Mileage
                    </th>
                    <th class="text-center table-column-width">
                    Mileage
                    </th>
                    <th class="text-center table-column-width3">
                    Average Cost Per Mile
                    </th>
                    <th class="text-center table-column-width10">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <ng-container
                    *ngIf="
                      !loading || (loading && manageVehicleList.length > 0)
                    "
                  >
                    <tr
                      *ngFor="
                        let vehicle of manageVehicleList
                          | statusSearch : searchByStatus
                      "
                    >
                      <td class="txt12">{{ vehicle.vehicleName }}</td>
                      <td class="txt12 text-center">{{ vehicle.modelYear }}</td>
                      <td class="txt12 text-center">{{ vehicle.vehicleClass }}</td>
                      <td class="text-center">{{ vehicle.vehicleType }}</td>
                      <td class="text-center">{{ vehicle.dtcAlert }}</td>
                      <td class="text-center">{{ vehicle.averageMileage }} mpg</td>
                      <td class="text-center">{{ vehicle.totalIdlingDuration }} miles</td>
                      <td class="txt12 text-center">${{ vehicle.averageCostPerMile }}</td>
                      <td class="txt12 text-center">
                        <ng-container
                          *ngIf="
                            vehicle?.status != 'FAILED' &&
                            vehicle?.status != 'PENDING' &&
                            vehicle?.status != 'DEACTIVATION_FAILED' &&
                            vehicle?.status != 'DEACTIVATED' &&
                            vehicle?.status != 'DEACTIVATION_PENDING'
                          "
                        >
                          <button
                            class="safety-report-btn"
                            (click)="driverDetails(vehicle)"
                            ngbTooltip="Click to view detailed vehicle report"
                          >
                            <i class="fas fa-file-alt report-icon"></i>
                            Vehicle Report
                          </button>
                        </ng-container>
                      </td>
                    </tr>
                  </ng-container>
                  <ng-container
                    *ngIf="loading && manageVehicleList.length === 0"
                  >
                    <tr
                      *ngIf="
                        manageVehicleList?.length < 1
                          | statusSearch : searchByStatus
                      "
                    >
                      <td colspan="9">
                        <h5 class="heaidng-c">No Data Found ...</h5>
                      </td>
                    </tr>
                  </ng-container>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Pagination Section -->
      <div class="mt-2 text-end pagination-h">
        <span *ngIf="pages?.length <= 9" class="f-le">
          <div>
            <nav
              class="isolate inline-flex -space-x-px rounded-md shadow-sm pag-color"
              aria-label="Pagination"
            >
              <a
                (click)="selectPages(pageNumber - 1)"
                href="javascript:void(0)"
                [class.disabled]="pageNumber == 1"
                class="page pointer relative inline-flex items-center rounded-l-md px-2 py-2 text-sm font-medium text-gray-500 hover:bg-gray-50 focus:z-20"
              >
                <span class="sr-only">Previous</span>
                <img
                  src="../../../../../assets/images/left-img.svg"
                  class="right-page-arrow"
                />
              </a>
              <ng-container *ngFor="let page of pages">
                <a
                  [class.isActive]="page == pageNumber"
                  href="javascript:void(0)"
                  [ngClass]="{ pointer: page != '...' }"
                  aria-current="page"
                  (click)="selectPages(page)"
                  class="px-4 py-2 pageination-number"
                >
                  {{ page }}
                </a>
              </ng-container>
              <a
                (click)="selectPages(pageNumber + 1)"
                [class.disabled]="pageNumber == totalPages"
                class="page pointer relative inline-flex items-center rounded-r-md px-2 py-2 text-sm font-medium text-gray-500 hover:bg-gray-50 focus:z-20"
              >
                <span class="sr-only">Next</span>
                <img
                  src="../../../../../assets/images/right.svg"
                  class="right-page-arrow"
                />
              </a>
            </nav>
          </div>
        </span>

        <!-- Pagination for more than 9 pages -->
        <span *ngIf="pages?.length > 9" class="f-ri">
          <!-- Same pagination code as in ice-fuel component -->
        </span>

        <!-- Items per page selector -->
        <span class="f-ri mr--12">
          <select
            class="form-select"
            (change)="selectPage($event.target.value)"
            [(ngModel)]="pageSize"
          >
            <option value="5">5</option>
            <option value="10">10</option>
            <option value="20">20</option>
            <option value="40">40</option>
            <option value="80">80</option>
            <option value="100">100</option>
          </select>
        </span>
        <span class="pageination">Per Page</span>
      </div>

      <!-- Modal template for remarks -->
      <ng-template #remarks let-modal class="modal-width">
        <div class="modal-header">
          <h5 class="modal-title mt-0 font-weight-bold">Driver Details</h5>
          <button
            type="button"
            class="btn-close"
            (click)="modal.dismiss('Cross click')"
            aria-hidden="true"
          ></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <div class="col-xs-12 col-lg-12 failure-box">
              {{ selectedDriverDetails }}
            </div>
          </div>
        </div>
      </ng-template>
    </div>
  </div>
</div>
