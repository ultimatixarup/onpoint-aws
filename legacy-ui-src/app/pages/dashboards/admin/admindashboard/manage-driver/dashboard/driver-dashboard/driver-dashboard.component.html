<ngx-spinner bdColor="rgba(0, 0, 0, 0.8)" size="large" color="#fff" type="ball-circus" [fullScreen]="true">
  <p style="color: white">Loading...</p>
</ngx-spinner>
<!--Page main content-->
<div class="page-content page-content-main">
  <div class="row sideMenuItem">
    <div class="container">
      <div class="col-xs-12 content-right">
        <!-- Heading and Breadcrumb -->
        <div class="row">
          <div class="col-xs-12 col-lg-12">
            <span class="breadcrumb-left">
              <h1 class="login-headline heading-title">Manage Driver </h1>
            </span>
            <span class="breadcrumb-right mr-8">
              <ol class="breadcrumb">
                <ng-container *ngIf="user !='admin'">
                  <li class="breadcrumb-item">
                    <a routerLink="/adlp/admin/admindashboard/dashboardfleet" class="breadcrumb-h6"><i
                        class="bx bx-home-circle"></i></a>
                  </li>
                  <li class="breadcrumb-item inactive-bread"><a
                      routerLink="/adlp/admin/admindashboard/dashboardfleet">Dashboard</a></li>
                  <li class="breadcrumb-item text-selected active-bread">Manage Driver</li>
                </ng-container>
              </ol>
            </span>
          </div>
        </div>
        <!-- Heading and Breadcrumb End-->
        <!-- Consumer and Fleet Id Filter -->

        <div class="row">
          <div class="col-xs-12 col-lg-2">
            <div class="input-wrapper">
              <input class="form-control input-vin font-common" maxlength="17" type="text"
                (keyup.enter)="selectConsumer()" [(ngModel)]="searchByVin" placeholder="Enter Vehicle Name">
              <i class="search-icon fas fa-search"></i> <!-- Example of FontAwesome icon -->
            </div>
          </div>
          <!-- <div class="col-xs-12 col-lg-1">&nbsp;</div> -->
          <div class="col-xs-12 col-lg-2" style="margin-top: 6px">
            <button class="add-button" tooltip="Add Driver" (click)="viewDriver()">View Driver</button>
          </div>
          <div class="col-xs-12 col-lg-2" style="margin-top: 6px">
            <button class="add-button" tooltip="Add Driver" (click)="addDriver()"><b>+</b> Add Driver</button>
          </div>
          <div class="col-xs-12 col-lg-2" style="margin-top: 6px">
            <button class="add-button" tooltip="Bulk Driver" (click)="bulkDriver()"><b>+</b> Bulk Assign Driver</button>

          </div>
          <div class="col-xs-12 col-lg-2" style="margin-top: 6px">
            <ng-select [searchable]="true" class="newSelect1" [clearable]="true" placeholder="Organization Id/Name"
              [(ngModel)]="fleetIdData" (change)="onFleetIdChange()">
              <ng-option *ngFor="let fleet of fleetList" value="{{ fleet.id }}">{{ fleet.id }} - [{{ fleet.name
                }}]</ng-option>
            </ng-select>
          </div>
          <!-- <div class="col-xs-12 col-lg-2" style="margin-top: 6px;">
            <ng-select
            [searchable]="true"
            class="newSelect1"
            [clearable]="true"
            placeholder="Group Name"
            [items]="groupList"
            bindLabel="name"
            bindValue="id"
            [(ngModel)]="groupIdData"
            (change)="onGroupIdChange($event)">

            <ng-template ng-option-tmp let-item="item">
              <span [ngStyle]="{ 'padding-left.px': item.level * 18 }">
                {{ item.name }}
              </span>
            </ng-template>
          </ng-select>
          </div> -->
        </div>
        <!-- Consumer and Fleet Id Filter -->
        <!-- main container start -->
        <div class="table-container" style="margin-top: 24px;">
          <div class="row mr-table mr-12">
            <div class="col-lg-12 col-xs-12">
              <div class="table-wrapper" style="position: relative">
                <div class="table-responsive table-b">
                  <table class="table">
                    <thead class="table-head">
                      <tr>
                        <th class="table-column-width7">Vehicle Name</th>
                        <th class="table-column-width5">Assign Driver</th>
                        <th class="table-column-width7">Date <span
                            style="font-size: 10px; font-weight: 400!important;">(Start - End)</span></th>
                        <th class="table-column-width7">Time <span
                            style="font-size: 10px; font-weight: 400!important;">(Start - End)</span></th>
                        <th class="table-column-width">Email</th>
                        <th class="table-column-width">Phone no.</th>
                        <th class="table-column-width">Action</th>
                      </tr>
                    </thead>
                    <tbody style="background-color: #fff!important;">
                      <ng-container *ngFor="let vehicle of vehicle_names | filterByVin: searchByVin">
                        <tr *ngIf="vehicle?.drivers.length === 0" style="height: 80px;">
                          <td>
                              <span class="flex-center">{{ vehicle?.alias || 'No VIN available' }}</span><br />
                              <a href="javascript:(void)" (click)="assignDriver(vehicle?.vin)" class="assign-link">+
                                Assign multiple drivers</a>
                          </td>
                          <td colspan="6" class="text-center">No driver data available</td>
                        </tr>
                        <tr *ngIf="vehicle?.drivers.length > 0">
                          <td class="align-top">
                            <span class="flex-center">{{ vehicle?.alias || 'No Vehicle available' }}</span><br />
                            <a href="javascript:void(0)" (click)="assignDriver(vehicle?.vin)" class="assign-link">+ Assign
                              multiple drivers</a>
                          </td>
                          <!-- [ngClass]="getAssociatedColor(data?.associatedStart, data?.associatedEnd)" -->
                          <td class="mainData-table">
                            <div *ngFor="let data of vehicle?.drivers" class="driver-info">
                              {{ data?.firstName || 'No First Name' }} {{ data?.lastName || 'No Last Name' }}
                            </div>
                          </td>
                          <td class="mainData-table">
                            <div *ngFor="let data of vehicle?.drivers" class="driver-info">
                              {{ data?.associatedStart ? (data?.associatedStart | date: 'MM/dd/yyyy') : 'No Start Date' }}
                              -
                              {{ data?.associatedEnd ? (data?.associatedEnd | date: 'MM/dd/yyyy') : 'No End Date' }}
                            </div>
                          </td>
                          <td class="mainData-table">
                            <div *ngFor="let data of vehicle?.drivers" class="driver-info">
                              {{ data?.associatedStart ? (data?.associatedStart | date: 'HH:mm') : 'No Start Time' }}
                              -
                              {{ data?.associatedEnd ? (data?.associatedEnd | date: 'HH:mm') : 'No End Time' }}
                            </div>
                          </td>
                          <td class="mainData-table">
                            <div *ngFor="let data of vehicle?.drivers" class="driver-info">
                              {{ data?.email || 'No Email' }}
                            </div>
                          </td>
                          <td class="mainData-table">
                            <div *ngFor="let data of vehicle?.drivers" class="driver-info">
                              {{ data?.phoneNo || 'No Phone Number' }}
                            </div>
                          </td>
                          <td class="mainData-table">
                            <div *ngFor="let data of vehicle?.drivers" class="driver-info">
                              <img   [class.disabled]="!isButtonEnabled(data.associatedStart, data.associatedEnd)"
                                src="../../../../../../../../assets/images/delete-assign-driver.svg"
                                alt="" ngbTooltip="Delete"
                                (click)="openConfirmModal(data, vehicle)"
                                class="action-img mark-up" />
                              </div>
                          </td>
                        </tr>
                      </ng-container>
                      <ng-container
                        *ngIf="vehicle_names.length === 0 || (vehicle_names | filterByVin: searchByVin)?.length === 0">
                        <tr>
                          <td colspan="7">
                            <h5 class="text-center">No Vehicle found</h5>
                          </td>
                        </tr>
                      </ng-container>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="mt-2 text-end pagination-h" style="margin-bottom: 125px;">
          <div class="pagination">
            <button class="previous-btn" (click)="onPageChange('prev')"
              [disabled]="currentPage === 1 || totalPages === 0">
              <img src="../../../../../assets/images/left-img.svg" />
            </button>
            <span *ngFor="let page of pageNumbers">
              <button (click)="onPageChange(page)" [class.active]="currentPage === page" [disabled]="page === '...'">
                {{ page }}
              </button>
            </span>
            <button class="previous-btn" (click)="onPageChange('next')"
              [disabled]="currentPage === totalPages || totalPages === 0">
              <img src="../../../../../assets/images/right.svg" />
            </button>
          </div>
        </div>
        <!-- main container end -->
      </div>
    <!-- Main Content Right End-->
  </div>
  </div>
</div>
 <!-- Delete VIN asssociation -->
 <ng-template #modalConfirm let-modal class="modal-width">
  <div class="modal-body modal-height">
    <h5 class="heading-show">Do you want to delete the driver <span class="delete-geofence">{{selectedDriverName}} {{selectedDriverLastName}}</span> associated with Vehicle <span class="delete-geofence">{{selectedVehicle?.alias}}</span> ?</h5>
  </div>
  <div class="modal-footer">
    <button class="btn-add-vin deletebtn" (click)="deleteDriver(selectedDriverData.transitionId); modal.dismiss()">Yes</button>
    <button class="btn-cancel cancelbtn" (click)="modal.dismiss()">No</button>
  </div>
</ng-template>
<!-- Delete VIN asssociation-->
